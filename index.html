<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CSGO饰品市场崩盘模拟</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a3a, #0d1824);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(30, 40, 50, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #34495e;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }
        
        h1 {
            color: #3498db;
            font-size: 24px;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            color: #95a5a6;
            font-size: 14px;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-card {
            background: rgba(40, 55, 70, 0.7);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            margin-top: 5px;
            color: #f1c40f;
        }
        
        .chart-container {
            background: rgba(25, 35, 45, 0.7);
            border-radius: 10px;
            padding: 15px;
            height: 250px;
            margin-bottom: 15px;
        }
        
        .items-panel {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .item-card {
            background: rgba(40, 55, 70, 0.7);
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .item-card.active {
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
        
        .item-card:hover {
            transform: translateY(-3px);
        }
        
        .item-name {
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }
        
        .item-price {
            font-size: 18px;
            color: #f1c40f;
        }
        
        .item-change {
            font-size: 14px;
        }
        
        .positive {
            color: #2ecc71;
        }
        
        .negative {
            color: #e74c3c;
        }
        
        .actions-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .trade-inputs {
            display: flex;
            gap: 10px;
        }
        
        input, button {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
        }
        
        input {
            flex: 1;
            background: rgba(50, 65, 80, 0.8);
            color: white;
            border: 1px solid #34495e;
        }
        
        button {
            background: #3498db;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: bold;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }
        
        .sell-btn {
            background: #e74c3c;
        }
        
        .sell-btn:hover {
            background: #c0392b;
        }
        
        .next-day-btn {
            background: #2ecc71;
            margin-top: 10px;
        }
        
        .next-day-btn:hover {
            background: #27ae60;
        }
        
        .history-panel {
            background: rgba(25, 35, 45, 0.7);
            border-radius: 10px;
            padding: 15px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .history-title {
            font-size: 16px;
            margin-bottom: 10px;
            color: #3498db;
        }
        
        .history-item {
            padding: 8px;
            border-bottom: 1px solid #34495e;
            font-size: 14px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #1a2a3a;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            border: 2px solid #3498db;
            animation: popIn 0.3s ease-out;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .modal-header {
            color: #3498db;
            font-size: 20px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .modal-body {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .modal-footer {
            text-align: center;
        }
        
        .close-btn {
            background: #e74c3c;
            width: 100%;
        }
        
        .crash-effect {
            animation: crashShake 0.5s ease-in-out;
        }
        
        @keyframes crashShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .event-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            background: #e74c3c;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .day-indicator {
            text-align: center;
            margin-bottom: 10px;
            font-size: 18px;
            color: #f1c40f;
        }
        
        /* 响应式设计 */
        @media (max-width: 600px) {
            .stats-panel, .items-panel {
                grid-template-columns: 1fr;
            }
            
            .trade-inputs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CSGO饰品市场崩盘模拟</h1>
            <div class="subtitle">亲身体验V社一行代码如何引发虚拟经济地震</div>
        </header>
        
        <div class="game-area">
            <div class="day-indicator">第 <span id="current-day">1</span> 天 - <span id="date-display">10月16日</span></div>
            
            <div class="stats-panel">
                <div class="stat-card">
                    <div>现金余额</div>
                    <div class="stat-value">¥<span id="cash-amount">50000</span></div>
                </div>
                <div class="stat-card">
                    <div>持仓价值</div>
                    <div class="stat-value">¥<span id="inventory-value">0</span></div>
                </div>
                <div class="stat-card">
                    <div>总资产</div>
                    <div class="stat-value">¥<span id="total-assets">50000</span></div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="price-chart"></canvas>
            </div>
            
            <div class="items-panel">
                <div class="item-card active" data-item="butterfly">
                    <div class="item-name">蝴蝶刀</div>
                    <div class="item-price">¥<span id="butterfly-price">42000</span></div>
                    <div class="item-change positive" id="butterfly-change">+0.0%</div>
                </div>
                <div class="item-card" data-item="gloves">
                    <div class="item-name">专业手套</div>
                    <div class="item-price">¥<span id="gloves-price">28000</span></div>
                    <div class="item-change positive" id="gloves-change">+0.0%</div>
                </div>
                <div class="item-card" data-item="dragon">
                    <div class="item-name">AWP 巨龙传说</div>
                    <div class="item-price">¥<span id="dragon-price">120000</span></div>
                    <div class="item-change positive" id="dragon-change">+0.0%</div>
                </div>
                <div class="item-card" data-item="dagger">
                    <div class="item-name">穿肠刀</div>
                    <div class="item-price">¥<span id="dagger-price">8000</span></div>
                    <div class="item-change positive" id="dagger-change">+0.0%</div>
                </div>
            </div>
            
            <div class="actions-panel">
                <div class="trade-inputs">
                    <input type="number" id="trade-amount" placeholder="输入交易数量" min="1" value="1">
                    <button id="buy-btn">买入</button>
                    <button id="sell-btn" class="sell-btn">卖出</button>
                </div>
                <button id="next-day-btn" class="next-day-btn">下一天</button>
            </div>
            
            <div class="history-panel">
                <div class="history-title">交易记录</div>
                <div id="history-list"></div>
            </div>
        </div>
    </div>
    
    <!-- 事件弹窗 -->
    <div id="event-modal" class="modal">
        <div class="modal-content">
            <div class="event-indicator"></div>
            <div class="modal-header" id="event-title">市场传闻</div>
            <div class="modal-body" id="event-content">
                听说V社即将有重大更新，市场情绪躁动...
            </div>
            <div class="modal-footer">
                <button id="close-event" class="close-btn">确认</button>
            </div>
        </div>
    </div>
    
    <!-- 结局弹窗 -->
    <div id="result-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="result-title">游戏结束</div>
            <div class="modal-body" id="result-content">
                根据您的最终资产盈亏比例，生成不同结局评语...
            </div>
            <div class="modal-footer">
                <button id="restart-btn" class="next-day-btn">重新开始</button>
            </div>
        </div>
    </div>

    <script>
        // 游戏数据
        const gameData = {
            currentDay: 1,
            cash: 50000,
            inventory: {
                butterfly: 0,
                gloves: 0,
                dragon: 0,
                dagger: 0
            },
            prices: {
                butterfly: [42000],
                gloves: [28000],
                dragon: [120000],
                dagger: [8000]
            },
            selectedItem: 'butterfly',
            priceHistory: [],
            events: [
                { day: 1, title: "背景介绍", content: "2025年10月，CSGO饰品市场异常繁荣。蝴蝶刀价格突破4万元，专业手套、巨龙传说等高端饰品价格持续走高。许多年轻人将饰品视为理财工具，市场投机氛围浓厚。" },
                { day: 2, title: "市场传闻", content: "社区开始流传V社即将推出重大更新的消息，有分析师认为这可能对饰品市场产生深远影响。部分投资者开始谨慎观望。" },
                { day: 4, title: "分析师看涨", content: "知名饰品分析师发布报告，认为高端饰品的稀缺性将支撑其价格长期上涨，建议投资者逢低买入。市场情绪再度乐观。" },
                { day: 6, title: "预警信号", content: "有消息称V社将在近期调整饰品系统，但具体内容未知。部分大户开始减仓，市场出现小幅波动。" },
                { day: 7, title: "V社更新公告", content: "10月23日，V社发布更新：'5件普通隐秘品质皮肤（红色），可汰换1把普通刀具或1副普通手套。' 这一行代码彻底改变了饰品生成逻辑！" },
                { day: 8, title: "市场崩盘", content: "更新发布后，高端饰品价格断崖式下跌。蝴蝶刀从4.2万元跌至9800元，专业手套、巨龙传说等价格腰斩。市场恐慌情绪蔓延。" }
            ],
            dates: [
                "10月16日", "10月17日", "10月18日", "10月19日", 
                "10月20日", "10月21日", "10月22日", "10月23日", "10月24日"
            ]
        };

        // 图表实例
        let priceChart;

        // DOM加载完成后初始化游戏
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
            setupEventListeners();
            drawPriceChart();
        });

        // 初始化游戏
        function initializeGame() {
            updateUI();
            showEvent(1); // 显示第一天的事件
        }

        // 设置事件监听
        function setupEventListeners() {
            // 物品选择
            document.querySelectorAll('.item-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.item-card').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    gameData.selectedItem = this.getAttribute('data-item');
                    drawPriceChart();
                });
            });

            // 买入按钮
            document.getElementById('buy-btn').addEventListener('click', function() {
                const amount = parseInt(document.getElementById('trade-amount').value) || 0;
                if (amount > 0) {
                    buyItem(gameData.selectedItem, amount);
                }
            });

            // 卖出按钮
            document.getElementById('sell-btn').addEventListener('click', function() {
                const amount = parseInt(document.getElementById('trade-amount').value) || 0;
                if (amount > 0) {
                    sellItem(gameData.selectedItem, amount);
                }
            });

            // 下一天按钮
            document.getElementById('next-day-btn').addEventListener('click', nextDay);

            // 关闭事件弹窗
            document.getElementById('close-event').addEventListener('click', function() {
                document.getElementById('event-modal').style.display = 'none';
            });

            // 重新开始按钮
            document.getElementById('restart-btn').addEventListener('click', function() {
                location.reload();
            });
        }

        // 买入物品
        function buyItem(item, amount) {
            const currentPrice = gameData.prices[item][gameData.prices[item].length - 1];
            const cost = currentPrice * amount;
            
            if (cost > gameData.cash) {
                alert('现金不足！');
                return;
            }
            
            gameData.cash -= cost;
            gameData.inventory[item] += amount;
            
            addToHistory(`买入 ${amount} 件 ${getItemName(item)}，价格 ¥${currentPrice.toLocaleString()}`);
            updateUI();
        }

        // 卖出物品
        function sellItem(item, amount) {
            if (gameData.inventory[item] < amount) {
                alert('持有数量不足！');
                return;
            }
            
            const currentPrice = gameData.prices[item][gameData.prices[item].length - 1];
            const revenue = currentPrice * amount;
            
            gameData.cash += revenue;
            gameData.inventory[item] -= amount;
            
            addToHistory(`卖出 ${amount} 件 ${getItemName(item)}，价格 ¥${currentPrice.toLocaleString()}`);
            updateUI();
        }

        // 进入下一天
        function nextDay() {
            if (gameData.currentDay >= 8) {
                endGame();
                return;
            }
            
            gameData.currentDay++;
            
            // 更新价格
            updatePrices();
            
            // 更新UI
            updateUI();
            drawPriceChart();
            
            // 显示事件（如果有）
            if (gameData.currentDay <= 8) {
                setTimeout(() => {
                    showEvent(gameData.currentDay);
                }, 500);
            }
            
            // 如果是崩盘日（第7天），添加震动效果
            if (gameData.currentDay === 7) {
                document.querySelector('.container').classList.add('crash-effect');
                setTimeout(() => {
                    document.querySelector('.container').classList.remove('crash-effect');
                }, 500);
            }
        }

        // 更新价格
        function updatePrices() {
            const items = ['butterfly', 'gloves', 'dragon', 'dagger'];
            
            items.forEach(item => {
                const lastPrice = gameData.prices[item][gameData.prices[item].length - 1];
                let newPrice;
                
                // 根据天数决定价格变化
                if (gameData.currentDay < 7) {
                    // 崩盘前：缓慢波动，略有上涨
                    const changeRate = (Math.random() * 0.1) - 0.03; // -3% 到 +7%
                    newPrice = lastPrice * (1 + changeRate);
                } else if (gameData.currentDay === 7) {
                    // 崩盘日：大幅下跌
                    newPrice = lastPrice * (0.2 + Math.random() * 0.3); // 下跌50%-80%
                } else {
                    // 崩盘后：继续小幅下跌或震荡
                    const changeRate = (Math.random() * 0.15) - 0.1; // -10% 到 +5%
                    newPrice = lastPrice * (1 + changeRate);
                }
                
                // 确保价格不会低于1000元
                newPrice = Math.max(newPrice, 1000);
                gameData.prices[item].push(Math.round(newPrice));
            });
        }

        // 显示事件
        function showEvent(day) {
            const event = gameData.events.find(e => e.day === day);
            if (event) {
                document.getElementById('event-title').textContent = event.title;
                document.getElementById('event-content').textContent = event.content;
                document.getElementById('event-modal').style.display = 'flex';
            }
        }

        // 结束游戏
        function endGame() {
            const initialAssets = 50000;
            const finalAssets = calculateTotalAssets();
            const profitRate = (finalAssets - initialAssets) / initialAssets * 100;
            
            let title, content;
            
            if (profitRate >= 20) {
                title = "逃顶大师";
                content = `恭喜！您在市场崩盘前成功逃顶，总资产增长 ${profitRate.toFixed(1)}%。您的投资嗅觉比市场快一步，成功保住了收益。`;
            } else if (profitRate >= -10) {
                title = "惊魂未定";
                content = `您成功保住了本金，总资产变化 ${profitRate.toFixed(1)}%。虽然经历了市场剧烈波动，但您成功避免了重大损失。`;
            } else {
                title = "深度套牢";
                content = `您的总资产缩水 ${Math.abs(profitRate).toFixed(1)}%。虚拟饰品市场的风险需要每一个参与者警惕，这次经历或许是一次宝贵的教训。`;
            }
            
            content += "\n\nCSGO饰品市场崩盘事件揭示了虚拟经济的脆弱性——当资产价值完全依赖于单一平台的规则时，任何政策变化都可能导致市场剧烈波动。";
            
            document.getElementById('result-title').textContent = title;
            document.getElementById('result-content').textContent = content;
            document.getElementById('result-modal').style.display = 'flex';
        }

        // 更新UI
        function updateUI() {
            // 更新当前天数
            document.getElementById('current-day').textContent = gameData.currentDay;
            document.getElementById('date-display').textContent = gameData.dates[gameData.currentDay - 1];
            
            // 更新现金余额
            document.getElementById('cash-amount').textContent = gameData.cash.toLocaleString();
            
            // 更新物品价格和涨跌幅
            const items = ['butterfly', 'gloves', 'dragon', 'dagger'];
            items.forEach(item => {
                const currentPrice = gameData.prices[item][gameData.prices[item].length - 1];
                const prevPrice = gameData.prices[item][gameData.prices[item].length - 2] || currentPrice;
                const change = ((currentPrice - prevPrice) / prevPrice * 100).toFixed(1);
                
                document.getElementById(`${item}-price`).textContent = currentPrice.toLocaleString();
                const changeElement = document.getElementById(`${item}-change`);
                changeElement.textContent = `${change >= 0 ? '+' : ''}${change}%`;
                changeElement.className = `item-change ${change >= 0 ? 'positive' : 'negative'}`;
            });
            
            // 更新持仓价值和总资产
            const inventoryValue = calculateInventoryValue();
            const totalAssets = gameData.cash + inventoryValue;
            
            document.getElementById('inventory-value').textContent = inventoryValue.toLocaleString();
            document.getElementById('total-assets').textContent = totalAssets.toLocaleString();
            
            // 更新下一个交易日按钮
            if (gameData.currentDay >= 8) {
                document.getElementById('next-day-btn').textContent = '查看结果';
            }
        }

        // 计算持仓价值
        function calculateInventoryValue() {
            let value = 0;
            const items = ['butterfly', 'gloves', 'dragon', 'dagger'];
            
            items.forEach(item => {
                const currentPrice = gameData.prices[item][gameData.prices[item].length - 1];
                value += gameData.inventory[item] * currentPrice;
            });
            
            return value;
        }

        // 计算总资产
        function calculateTotalAssets() {
            return gameData.cash + calculateInventoryValue();
        }

        // 添加交易记录
        function addToHistory(text) {
            const historyList = document.getElementById('history-list');
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.textContent = `第${gameData.currentDay}天: ${text}`;
            historyList.appendChild(historyItem);
            historyList.scrollTop = historyList.scrollHeight;
        }

        // 获取物品名称
        function getItemName(item) {
            const names = {
                butterfly: '蝴蝶刀',
                gloves: '专业手套',
                dragon: 'AWP 巨龙传说',
                dagger: '穿肠刀'
            };
            return names[item];
        }

        // 绘制价格图表
        function drawPriceChart() {
            const ctx = document.getElementById('price-chart').getContext('2d');
            
            if (priceChart) {
                priceChart.destroy();
            }
            
            const itemData = gameData.prices[gameData.selectedItem];
            const labels = Array.from({length: itemData.length}, (_, i) => `第${i+1}天`);
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${getItemName(gameData.selectedItem)}价格走势`,
                        data: itemData,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e0e0e0'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#e0e0e0'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#e0e0e0',
                                callback: function(value) {
                                    return '¥' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>